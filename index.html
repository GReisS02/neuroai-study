<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>NeuroAI Study · Fiscal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Firebase Imports (Módulos ES) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyB49R1ZycEX_4Q6vzaM7wNYdi5qf3Zfm2M",
          authDomain: "neuroai-study-3a97b.firebaseapp.com",
          projectId: "neuroai-study-3a97b",
          storageBucket: "neuroai-study-3a97b.firebasestorage.app",
          messagingSenderId: "233819898876",
          appId: "1:233819898876:web:f48f18e06c6a13e91aa879"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        const appId = 'neuro-fiscal-app'; 
        let userId = null;

        window.firebaseApp = { 
            login: async () => {
                try { await signInWithPopup(auth, provider); }
                catch (error) { alert("Erro ao logar: " + error.message); }
            },
            logout: async () => {
                try { await signOut(auth); window.location.reload(); }
                catch (error) {}
            }
        };

        onAuthStateChanged(auth, (user) => {
            const loginBtn = document.getElementById('btn-login-google');
            const userProfile = document.getElementById('user-profile-area');
            const userImg = document.getElementById('user-avatar');
            
            if (user) {
                userId = user.uid;
                window.userId = userId;
                
                if(loginBtn) loginBtn.classList.add('hidden');
                if(userProfile) userProfile.classList.remove('hidden');
                if(userImg) userImg.src = user.photoURL || '';
                
                updateSyncStatus('online');
                setupRealtimeListener();
            } else {
                if(loginBtn) loginBtn.classList.remove('hidden');
                if(userProfile) userProfile.classList.add('hidden');
                updateSyncStatus('offline');
            }
        });

        function setupRealtimeListener() {
            if (!userId) return;
            const docRef = doc(db, 'artifacts', appId, 'users', userId, 'data', 'study_cycle');
            
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data && data.payload) {
                        window.appData = JSON.parse(data.payload);
                        window.renderTable(window.isFilterTodayActive, true); 
                        window.updateStats();
                    }
                } else {
                    window.saveData(true);
                }
            });
        }

        window.saveData = async function(force = false) {
            if (!userId) return;
            const docRef = doc(db, 'artifacts', appId, 'users', userId, 'data', 'study_cycle');
            await setDoc(docRef, { 
                payload: JSON.stringify(window.appData),
                lastUpdate: new Date().toISOString(),
                userEmail: auth.currentUser.email
            });
            window.updateStats();
        };

        function updateSyncStatus(status) {
            const el = document.getElementById('sync-status-text');
            if (!el) return;
            el.innerText = status.toUpperCase();
        }
    </script>

    <!-- ================== NOVO STYLE MINIMAL DARK v8 ================== -->
    <style>
    :root {
        --bg-main: #070b12;
        --bg-panel: #0f1722;
        --bg-elevated: #131c2b;
        --border-subtle: #1f2937;
        --border-strong: #334155;
        --accent: #22d3ee;
        --accent-soft: rgba(34,211,238,0.15);
        --danger: #ef4444;
        --text-main: #f1f5f9;
        --text-muted: #64748b;
    }

    * { box-sizing: border-box; }

    body {
        font-family: 'Inter', sans-serif;
        background: radial-gradient(circle at 30% 20%, #111827 0%, #070b12 70%);
        color: var(--text-main);
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
    }

    .glass-panel {
        background: var(--bg-panel);
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        transition: 0.2s ease;
    }

    .glass-panel:hover {
        border-color: var(--border-strong);
    }

    .nav-container {
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        padding: 4px;
        border-radius: 10px;
        display: flex;
        gap: 4px;
    }

    .nav-btn {
        background: transparent;
        color: var(--text-muted);
        padding: 8px 22px;
        font-size: 0.75rem;
        font-weight: 700;
        font-family: 'JetBrains Mono', monospace;
        border-radius: 8px;
        border: 1px solid transparent;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .nav-btn:hover {
        color: white;
        background: #1a2333;
    }

    .nav-btn.active {
        background: #111827;
        color: var(--accent);
        border: 1px solid var(--accent);
        box-shadow: 0 0 15px var(--accent-soft);
    }

    .tabela-ciclo th {
        background: var(--bg-panel);
        color: var(--text-muted);
        border-bottom: 1px solid var(--border-strong);
    }

    .tabela-ciclo td {
        background: var(--bg-elevated);
        border-bottom: 1px solid var(--border-subtle);
    }

    .disciplina-row td {
        background: #111827;
        font-weight: 600;
        border-top: 1px solid var(--border-strong);
    }

    .conteudo-row:hover td {
        background: #182233;
    }

    .input-tech:read-only,
    .input-number-tech:read-only {
        color: var(--text-muted);
    }

    .input-tech:not(:read-only),
    .input-number-tech:not(:read-only) {
        border: 1px solid var(--accent);
        box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .rev-pending-tech {
        background: var(--danger);
        box-shadow: 0 0 12px rgba(239,68,68,0.5);
    }

    .btn-primary-tech {
        background: linear-gradient(135deg,#0ea5e9,#6366f1);
        box-shadow: 0 6px 20px rgba(99,102,241,0.4);
    }
    </style>
</head>
<body class="antialiased">
