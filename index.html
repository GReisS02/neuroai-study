<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroAI Study ¬∑ TEC Concursos ¬∑ Ciclo 90 Dias</title>
    
    <!-- CSS e bibliotecas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0c0e;
            color: #e8eaed;
            min-height: 100vh;
        }

        :root {
            --bg-card: #1a1c1f;
            --border: #2f3336;
            --blue: #4285f4;
            --green: #34a853;
            --yellow: #fbbc04;
            --red: #ea4335;
            --purple: #8b5cf6;
            --pink: #ec4899;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
        }

        .card:hover {
            border-color: var(--blue);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: linear-gradient(145deg, #1a1c1f, #1e1f22);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
            background: #2a2b2e;
            color: #e8eaed;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: rgba(66, 133, 244, 0.2);
            border-color: var(--blue);
            color: #89b6ff;
        }

        .btn-primary:hover {
            background: rgba(66, 133, 244, 0.3);
        }

        .btn-ai {
            background: rgba(139, 92, 246, 0.2);
            border-color: var(--purple);
            color: #c4b5fd;
        }

        .table-container {
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow-x: auto;
            overflow-y: auto;
            background: var(--bg-card);
            max-height: 70vh;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 2800px;
            font-size: 0.85rem;
        }

        th {
            background: #1e1f22;
            color: #9aa0a6;
            padding: 12px 4px;
            font-weight: 600;
            font-size: 0.7rem;
            text-transform: uppercase;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 8px 4px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        tr:hover td {
            background: #2a2b2e;
        }

        .tr-disciplina {
            background: #1e1f22;
            font-weight: 600;
        }

        .tr-disciplina td {
            border-bottom: 2px solid var(--blue);
        }

        /* Cores das revis√µes */
        .rev-r1 { background-color: rgba(66, 133, 244, 0.1); }
        .rev-r7 { background-color: rgba(251, 188, 4, 0.1); }
        .rev-r15 { background-color: rgba(234, 67, 53, 0.1); }
        .rev-r30 { background-color: rgba(52, 168, 83, 0.1); }
        .rev-r60 { background-color: rgba(139, 92, 246, 0.1); }
        .rev-r90 { background-color: rgba(236, 72, 153, 0.1); }

        .input-clean {
            background: transparent;
            border: 1px solid transparent;
            color: #e8eaed;
            padding: 4px 6px;
            border-radius: 4px;
            width: 100%;
            font-size: 0.8rem;
        }

        .input-clean:focus {
            border-color: var(--blue);
            outline: none;
            background: #1e1f22;
        }

        .input-mini {
            width: 40px;
            height: 26px;
            text-align: center;
            background: #2a2b2e;
            border: 1px solid var(--border);
            color: #e8eaed;
            border-radius: 3px;
            font-size: 0.75rem;
        }

        .input-micro {
            width: 35px;
            height: 24px;
            text-align: center;
            background: #2a2b2e;
            border: 1px solid var(--border);
            color: #e8eaed;
            border-radius: 3px;
            font-size: 0.7rem;
        }

        /* Status dots */
        .status-dot {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin: 0 auto;
            cursor: pointer;
            position: relative;
            display: inline-block;
        }

        .status-dot.done {
            background: rgba(52, 168, 83, 0.2);
            border: 1px solid var(--green);
        }

        .status-dot.done::after {
            content: '‚úì';
            color: var(--green);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }

        .status-dot.pending {
            background: rgba(234, 67, 53, 0.2);
            border: 1px solid var(--red);
            animation: pulse 2s infinite;
        }

        .status-dot.future {
            background: rgba(255, 255, 255, 0.1);
            border: 1px dashed var(--border);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Link TEC */
        .link-tec {
            color: #89b6ff;
            text-decoration: none;
            font-size: 0.7rem;
            display: inline-flex;
            align-items: center;
            gap: 2px;
            padding: 2px 4px;
            border-radius: 3px;
            background: rgba(66, 133, 244, 0.1);
        }

        .link-tec:hover {
            background: rgba(66, 133, 244, 0.2);
            color: white;
        }

        /* Relev√¢ncia badge */
        .relevancia-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
        }

        .relevancia-alta {
            background: rgba(234, 67, 53, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(234, 67, 53, 0.3);
        }

        .relevancia-media {
            background: rgba(251, 188, 4, 0.2);
            color: #fde047;
            border: 1px solid rgba(251, 188, 4, 0.3);
        }

        .relevancia-baixa {
            background: rgba(52, 168, 83, 0.2);
            color: #86efac;
            border: 1px solid rgba(52, 168, 83, 0.3);
        }

        .btn-add-topico {
            background: transparent;
            border: none;
            color: var(--blue);
            font-size: 0.65rem;
            cursor: pointer;
            padding: 2px 4px;
            opacity: 0.7;
            white-space: nowrap;
        }

        .btn-add-topico:hover {
            opacity: 1;
            text-decoration: underline;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: #1a1c1f;
            border: 1px solid var(--border);
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: auto;
            padding: 30px;
        }

        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.cloud {
            background: rgba(139, 92, 246, 0.2);
            color: #c4b5fd;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 3px;
            cursor: pointer;
        }

        /* SM-2 Buttons */
        .sm2-buttons {
            display: flex;
            gap: 2px;
            justify-content: center;
        }

        .sm2-btn {
            width: 22px;
            height: 22px;
            border-radius: 3px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .sm2-btn.easy {
            background: rgba(52, 168, 83, 0.3);
            color: #86efac;
        }
        .sm2-btn.medium {
            background: rgba(251, 188, 4, 0.3);
            color: #fde047;
        }
        .sm2-btn.hard {
            background: rgba(234, 67, 53, 0.3);
            color: #fca5a5;
        }

        .revisao-percent {
            font-size: 0.65rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="flex justify-between items-center mb-8">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg flex items-center justify-center text-xl">
                    üß†
                </div>
                <div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 text-transparent bg-clip-text">
                        NeuroAI Study ¬∑ TEC Concursos
                    </h1>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="status-badge cloud">‚òÅÔ∏è DATABASE: CLOUD</span>
                        <span class="text-xs text-gray-500">Ciclo 90 dias ¬∑ R1 R7 R15 R30 R60 R90</span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div id="userInfo" class="hidden items-center gap-3">
                    <img id="userAvatar" src="" class="w-8 h-8 rounded-full border-2 border-blue-500">
                    <span id="userName" class="text-sm"></span>
                    <button onclick="logout()" class="text-xs text-red-400 hover:text-red-300">Sair</button>
                </div>
                
                <button id="loginBtn" onclick="login()" class="btn btn-primary">
                    Entrar com Google
                </button>
                
                <div class="flex items-center gap-2 text-sm">
                    <div id="syncStatus" class="w-2 h-2 rounded-full bg-gray-500"></div>
                    <span id="syncText" class="text-gray-500">Offline</span>
                </div>
            </div>
        </div>

        <!-- ABAS -->
        <div class="flex gap-2 mb-6 border-b border-gray-800 pb-2 overflow-x-auto">
            <button onclick="showTab('dashboard')" id="tabDashboard" class="btn bg-transparent hover:bg-gray-800 active">üìä Dashboard</button>
            <button onclick="showTab('estudos')" id="tabEstudos" class="btn bg-transparent hover:bg-gray-800">üìö Ciclo de Estudos</button>
            <button onclick="showTab('metas')" id="tabMetas" class="btn bg-transparent hover:bg-gray-800">üéØ Metas</button>
            <button onclick="showTab('revisoes')" id="tabRevisoes" class="btn bg-transparent hover:bg-gray-800">üîÑ Calend√°rio</button>
            <button onclick="exportarDados()" class="btn bg-transparent hover:bg-gray-800">üì• Backup</button>
        </div>

        <!-- DASHBOARD -->
        <div id="dashboardView">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">Dashboard ¬∑ Acompanhamento</h2>
                <button onclick="consultCoach()" class="btn btn-ai">
                    <span>‚ú®</span> An√°lise Estrat√©gica IA
                </button>
            </div>

            <!-- Feedback IA -->
            <div id="coachFeedback" class="hidden mb-6 p-4 bg-gray-800 border-l-4 border-purple-500 rounded">
                <div id="coachText" class="text-sm"></div>
            </div>

            <!-- KPIs -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="text-gray-500 text-sm mb-2">Total Quest√µes</div>
                    <div class="kpi-value" id="kpiTotal">0</div>
                </div>
                <div class="kpi-card">
                    <div class="text-gray-500 text-sm mb-2">Desempenho Global</div>
                    <div class="kpi-value text-blue-400" id="kpiPerf">0%</div>
                </div>
                <div class="kpi-card">
                    <div class="text-gray-500 text-sm mb-2">Revis√µes Hoje</div>
                    <div class="kpi-value text-yellow-400" id="kpiRev">0</div>
                </div>
                <div class="kpi-card">
                    <div class="text-gray-500 text-sm mb-2">Progresso 90d</div>
                    <div class="kpi-value text-green-400" id="kpi90d">0%</div>
                </div>
            </div>

            <!-- Heatmap + √öltimos 7 dias -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="card">
                    <h3 class="font-semibold mb-4">üìä Const√¢ncia (30 dias)</h3>
                    <div id="heatmap" class="grid grid-cols-7 gap-1 max-w-[300px] mb-3"></div>
                    <div class="flex items-center gap-2 text-xs text-gray-500">
                        <span>Menos</span>
                        <div class="flex gap-1">
                            <div class="w-4 h-4 rounded bg-gray-700"></div>
                            <div class="w-4 h-4 rounded bg-green-900"></div>
                            <div class="w-4 h-4 rounded bg-green-700"></div>
                            <div class="w-4 h-4 rounded bg-green-500"></div>
                            <div class="w-4 h-4 rounded bg-green-300"></div>
                        </div>
                        <span>Mais</span>
                    </div>
                </div>

                <div class="card">
                    <h3 class="font-semibold mb-4">üìà √öltimos 7 dias</h3>
                    <div class="flex items-center gap-6 mb-4">
                        <div>
                            <div class="text-2xl font-bold" id="perf7d">0%</div>
                            <div class="text-xs text-gray-500">aproveitamento</div>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div>
                                <div class="text-gray-500">Quest√µes</div>
                                <div class="font-bold" id="total7d">0</div>
                            </div>
                            <div>
                                <div class="text-gray-500">Acertos</div>
                                <div class="font-bold text-green-400" id="acertos7d">0</div>
                            </div>
                            <div>
                                <div class="text-gray-500">Erros</div>
                                <div class="font-bold text-red-400" id="erros7d">0</div>
                            </div>
                        </div>
                    </div>
                    <div style="height: 60px;">
                        <canvas id="chartEvolucao"></canvas>
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="font-semibold mb-4">üìä Desempenho por Disciplina</h3>
                    <div style="height: 250px;">
                        <canvas id="chartDisciplinas"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3 class="font-semibold mb-4">üìä Distribui√ß√£o de Revis√µes</h3>
                    <div style="height: 250px;">
                        <canvas id="chartRevisoes"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ESTUDOS -->
        <div id="estudosView" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-semibold">Ciclo de Estudos ¬∑ TEC Concursos</h2>
                    <p class="text-xs text-gray-500">Dados importados da planilha ¬∑ Clique em "+ T√≥pico" para adicionar</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="showAddDisciplina()" class="btn btn-primary">+ Nova Disciplina</button>
                    <button onclick="toggleFiltroHoje()" id="btnHoje" class="btn">üî• Revis√µes Hoje</button>
                    <button onclick="analisarPrioridades()" class="btn btn-ai">üéØ Prioridades IA</button>
                </div>
            </div>

            <!-- Form add disciplina -->
            <div id="addForm" class="card mb-6 hidden p-4">
                <div class="flex gap-4 flex-wrap">
                    <input type="text" id="novaDisciplina" placeholder="Nome da disciplina" class="input-clean flex-1 min-w-[200px]">
                    <select id="pesoDisciplina" class="input-clean w-24">
                        <option value="3">Peso 3 (Alto)</option>
                        <option value="2" selected>Peso 2 (M√©dio)</option>
                        <option value="1">Peso 1 (Baixo)</option>
                    </select>
                    <button onclick="addDisciplina()" class="btn btn-primary">Salvar</button>
                    <button onclick="hideAddDisciplina()" class="btn">Cancelar</button>
                </div>
            </div>

            <!-- Alerta de revis√µes -->
            <div id="revisoesAlert" class="hidden mb-4 p-4 bg-gray-800 border-l-4 border-yellow-500 rounded flex justify-between items-center">
                <span id="revisoesText"></span>
                <button onclick="mostrarRevisoesHoje()" class="btn btn-ai text-sm">Ver revis√µes</button>
            </div>

            <!-- Tabela Principal -->
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 20px;"></th>
                            <th style="min-width: 300px;">DISCIPLINA / T√ìPICO - BLOCO</th>
                            <th style="width: 60px;">RELEV</th>
                            <th style="width: 45px;">PESO</th>
                            <th style="width: 45px;">QTD</th>
                            <th style="width: 45px;">AC</th>
                            <th style="width: 45px;">%</th>
                            <th style="width: 90px;">LINK TEC</th>
                            <th style="width: 60px;">ESTUD</th>
                            
                            <!-- Cabe√ßalho Revis√µes - R1 -->
                            <th colspan="3" style="background: rgba(66, 133, 244, 0.2); color: #4285f4;">R1</th>
                            <th colspan="3" style="background: rgba(251, 188, 4, 0.2); color: #fbbc04;">R7</th>
                            <th colspan="3" style="background: rgba(234, 67, 53, 0.2); color: #ea4335;">R15</th>
                            <th colspan="3" style="background: rgba(52, 168, 83, 0.2); color: #34a853;">R30</th>
                            <th colspan="3" style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6;">R60</th>
                            <th colspan="3" style="background: rgba(236, 72, 153, 0.2); color: #ec4899;">R90</th>
                            
                            <th style="width: 70px;">SM-2</th>
                            <th style="width: 30px;"></th>
                        </tr>
                        <tr>
                            <th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th>
                            
                            <!-- R1 -->
                            <th style="background: rgba(66, 133, 244, 0.1);">S</th>
                            <th style="background: rgba(66, 133, 244, 0.1);">QTD</th>
                            <th style="background: rgba(66, 133, 244, 0.1);">AC/%</th>
                            
                            <!-- R7 -->
                            <th style="background: rgba(251, 188, 4, 0.1);">S</th>
                            <th style="background: rgba(251, 188, 4, 0.1);">QTD</th>
                            <th style="background: rgba(251, 188, 4, 0.1);">AC/%</th>
                            
                            <!-- R15 -->
                            <th style="background: rgba(234, 67, 53, 0.1);">S</th>
                            <th style="background: rgba(234, 67, 53, 0.1);">QTD</th>
                            <th style="background: rgba(234, 67, 53, 0.1);">AC/%</th>
                            
                            <!-- R30 -->
                            <th style="background: rgba(52, 168, 83, 0.1);">S</th>
                            <th style="background: rgba(52, 168, 83, 0.1);">QTD</th>
                            <th style="background: rgba(52, 168, 83, 0.1);">AC/%</th>
                            
                            <!-- R60 -->
                            <th style="background: rgba(139, 92, 246, 0.1);">S</th>
                            <th style="background: rgba(139, 92, 246, 0.1);">QTD</th>
                            <th style="background: rgba(139, 92, 246, 0.1);">AC/%</th>
                            
                            <!-- R90 -->
                            <th style="background: rgba(236, 72, 153, 0.1);">S</th>
                            <th style="background: rgba(236, 72, 153, 0.1);">QTD</th>
                            <th style="background: rgba(236, 72, 153, 0.1);">AC/%</th>
                            
                            <th></th><th></th>
                        </tr>
                    </thead>
                    <tbody id="tabelaBody"></tbody>
                </table>
            </div>
        </div>

        <!-- METAS -->
        <div id="metasView" style="display: none;">
            <h2 class="text-xl font-semibold mb-6">Metas e Objetivos ¬∑ 90 Dias</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="font-semibold mb-4">üìÖ Meta Semanal</h3>
                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-2">
                            <span>Progresso</span>
                            <span id="progressoMeta">0 / 500</span>
                        </div>
                        <div class="w-full h-2 bg-gray-700 rounded-full overflow-hidden">
                            <div id="barraProgresso" class="h-full bg-gradient-to-r from-blue-500 to-purple-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="number" id="metaInput" value="500" class="input-clean w-24 text-center">
                        <button onclick="atualizarMeta()" class="btn btn-primary">Atualizar</button>
                    </div>
                </div>

                <div class="card">
                    <h3 class="font-semibold mb-4">‚è±Ô∏è Previs√£o Edital</h3>
                    <div class="text-3xl font-bold text-purple-400 mb-2" id="previsaoEdital">-</div>
                    <div class="text-sm text-gray-500">dias restantes (ciclo 90 dias)</div>
                    <div class="mt-4">
                        <div class="flex justify-between text-sm">
                            <span>Progresso do ciclo</span>
                            <span id="progressoCiclo">0%</span>
                        </div>
                        <div class="w-full h-2 bg-gray-700 rounded-full mt-1">
                            <div id="barraCiclo" class="h-full bg-gradient-to-r from-green-500 to-blue-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CALEND√ÅRIO REVIS√ïES -->
        <div id="revisoesView" style="display: none;">
            <h2 class="text-xl font-semibold mb-6">üìÖ Calend√°rio de Revis√µes ¬∑ 90 Dias</h2>
            
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
                <div class="card">
                    <h3 class="font-semibold mb-2 text-blue-400">R1 ¬∑ 1 dia</h3>
                    <div class="text-2xl font-bold" id="countR1">0</div>
                </div>
                <div class="card">
                    <h3 class="font-semibold mb-2 text-yellow-400">R7 ¬∑ 7 dias</h3>
                    <div class="text-2xl font-bold" id="countR7">0</div>
                </div>
                <div class="card">
                    <h3 class="font-semibold mb-2 text-red-400">R15 ¬∑ 15 dias</h3>
                    <div class="text-2xl font-bold" id="countR15">0</div>
                </div>
                <div class="card">
                    <h3 class="font-semibold mb-2 text-green-400">R30 ¬∑ 30 dias</h3>
                    <div class="text-2xl font-bold" id="countR30">0</div>
                </div>
                <div class="card">
                    <h3 class="font-semibold mb-2 text-purple-400">R60 ¬∑ 60 dias</h3>
                    <div class="text-2xl font-bold" id="countR60">0</div>
                </div>
                <div class="card">
                    <h3 class="font-semibold mb-2 text-pink-400">R90 ¬∑ 90 dias</h3>
                    <div class="text-2xl font-bold" id="countR90">0</div>
                </div>
            </div>

            <div class="card">
                <h3 class="font-semibold mb-4">Pr√≥ximas revis√µes (30 dias)</h3>
                <div id="timelineRevisoes" class="space-y-2 max-h-96 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <!-- MODAL -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalTitulo">NeuroAI Assistente</h3>
                <button onclick="fecharModal()" class="text-gray-500 hover:text-white text-xl">‚úï</button>
            </div>
            <div id="modalLoading" class="hidden text-center py-8">
                <div class="spinner mx-auto mb-4"></div>
                <p class="text-purple-400">Processando...</p>
            </div>
            <div id="modalContent" class="markdown-content"></div>
        </div>
    </div>

    <style>
        .spinner {
            border: 3px solid #2a2b2e;
            border-top: 3px solid #8b5cf6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .active {
            background: #2a2b2e;
        }
    </style>

    <script>
        // ========== CONFIGURA√á√ÉO FIREBASE ==========
        const firebaseConfig = {
            apiKey: "AIzaSyB49R1ZycEX_4Q6vzaM7wNYdi5qf3Zfm2M",
            authDomain: "neuroai-study-3a97b.firebaseapp.com",
            projectId: "neuroai-study-3a97b",
            storageBucket: "neuroai-study-3a97b.appspot.com",
            messagingSenderId: "233819898876",
            appId: "1:233819898876:web:f48f18e06c6a13e91aa879"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const provider = new firebase.auth.GoogleAuthProvider();

        // ========== DADOS DA PLANILHA TEC CONCURSOS ==========
        const DADOS_PLANILHA = [
            { disciplina: "ADMINISTRA√á√ÉO FINANCEIRA E OR√áAMENT√ÅRIA", peso: 2, topico: "Instrumentos Or√ßament√°rios: PPA/ LDO/ LOA.", bloco: "Bloco II", cobranca: 0.171 },
            { disciplina: "ADMINISTRA√á√ÉO FINANCEIRA E OR√áAMENT√ÅRIA", peso: 2, topico: "Lei Complementar n¬∫ 101/2000:", bloco: "Bloco VII", cobranca: 0.16 },
            { disciplina: "ADMINISTRA√á√ÉO FINANCEIRA E OR√áAMENT√ÅRIA", peso: 2, topico: "Or√ßamento P√∫blico: Conceitos e Classifica√ß√µes.", bloco: "Bloco I", cobranca: 0.135 },
            { disciplina: "ADMINISTRA√á√ÉO FINANCEIRA E OR√áAMENT√ÅRIA", peso: 2, topico: "Despesa p√∫blica.", bloco: "Bloco V", cobranca: 0.123 },
            { disciplina: "ADMINISTRA√á√ÉO FINANCEIRA E OR√áAMENT√ÅRIA", peso: 2, topico: "Receita p√∫blica.", bloco: "Bloco IV", cobranca: 0.083 },
            { disciplina: "ADMINISTRA√á√ÉO FINANCEIRA E OR√áAMENT√ÅRIA", peso: 2, topico: "Lei Complementar n¬∫ 101/2000:", bloco: "Bloco VIII", cobranca: 0.079 },
            { disciplina: "ADMINISTRA√á√ÉO FINANCEIRA E OR√áAMENT√ÅRIA", peso: 2, topico: "Cr√©ditos ordin√°rios e adicionais.", bloco: "Bloco III", cobranca: 0.074 },
            
            { disciplina: "AUDITORIA FISCAL", peso: 2, topico: "Testes em √°reas espec√≠ficas das Demonstra√ß√µes Cont√°beis", bloco: "Bloco VI", cobranca: 0.2 },
            { disciplina: "AUDITORIA FISCAL", peso: 2, topico: "NFe e EFD", bloco: "Bloco VII", cobranca: 0.19 },
            { disciplina: "AUDITORIA FISCAL", peso: 2, topico: "Testes e Procedimentos em Auditoria", bloco: "Bloco III", cobranca: 0.1 },
            { disciplina: "AUDITORIA FISCAL", peso: 2, topico: "Materialidade, Relev√¢ncia e Risco / Evid√™ncia em Auditoria", bloco: "Bloco II", cobranca: 0.089 },
            { disciplina: "AUDITORIA FISCAL", peso: 2, topico: "Normas Profissionais do Auditor Independente / Planejamento de Auditoria Independente", bloco: "Bloco I", cobranca: 0.081 },
            { disciplina: "AUDITORIA FISCAL", peso: 2, topico: "Opini√£o do auditor /Relat√≥rios e Pareceres de Auditoria", bloco: "Bloco V", cobranca: 0.05 },
            { disciplina: "AUDITORIA FISCAL", peso: 2, topico: "Fraude e Erro (Auditoria)", bloco: "Bloco IV", cobranca: 0.046 },
            
            { disciplina: "CONTABILIDADE DE CUSTOS", peso: 2, topico: "Custeio por Absor√ß√£o:", bloco: "Bloco II", cobranca: 0.342 },
            { disciplina: "CONTABILIDADE DE CUSTOS", peso: 2, topico: "Custos para Decis√£o: p1", bloco: "Bloco III", cobranca: 0.263 },
            { disciplina: "CONTABILIDADE DE CUSTOS", peso: 2, topico: "Custos para Decis√£o: p2", bloco: "Bloco IV", cobranca: 0.184 },
            { disciplina: "CONTABILIDADE DE CUSTOS", peso: 2, topico: "Custos:", bloco: "Bloco I", cobranca: 0.172 },
            
            { disciplina: "CONTABILIDADE GERAL", peso: 2, topico: "Demonstra√ß√µes Cont√°beis: p2", bloco: "Bloco IX", cobranca: 0.311 },
            { disciplina: "CONTABILIDADE GERAL", peso: 2, topico: "Ativo: p1", bloco: "Bloco III", cobranca: 0.219 },
            { disciplina: "CONTABILIDADE GERAL", peso: 2, topico: "Demonstra√ß√µes Cont√°beis: p1", bloco: "Bloco VIII", cobranca: 0.21 },
            { disciplina: "CONTABILIDADE GERAL", peso: 2, topico: "Conceito, Objeto, Finalidade, T√©cnicas Cont√°beis, Equa√ß√£o patrimonial / Regimes Cont√°beis (compet√™ncia, caixa e misto)", bloco: "Bloco I", cobranca: 0.127 },
            { disciplina: "CONTABILIDADE GERAL", peso: 2, topico: "Estoques:", bloco: "Bloco II", cobranca: 0.11 },
            { disciplina: "CONTABILIDADE GERAL", peso: 2, topico: "Demonstra√ß√µes Cont√°beis: p3", bloco: "Bloco X", cobranca: 0.088 },
            { disciplina: "CONTABILIDADE GERAL", peso: 2, topico: "Passivo exig√≠vel:", bloco: "Bloco VI", cobranca: 0.083 },
            { disciplina: "CONTABILIDADE GERAL", peso: 2, topico: "Ativo: p2", bloco: "Bloco IV", cobranca: 0.048 },
            
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Limita√ß√µes Constitucionais ao Poder de Tributar (arts. 150 a 152 - CF/88)", bloco: "Bloco II", cobranca: 0.116 },
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Tributos (arts. 03-08, 16-18, 76-82 - CTN)", bloco: "Bloco I", cobranca: 0.1 },
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Garantias e Privil√©gios do Cr√©dito Tribut√°rio (arts. 183 ao 193 - CTN) / Administra√ß√£o Tribut√°ria (arts. 194 ao 208; 210 - CTN)", bloco: "Bloco VIII", cobranca: 0.092 },
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Obriga√ß√£o Tribut. (arts. 119 ao 138 - CTN) / Solidariedade (arts. 124 e 125 do CTN) p1", bloco: "Bloco V", cobranca: 0.084 },
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Impostos de Compet√™ncia dos Estados (art. 155 - CF/88)", bloco: "Bloco X", cobranca: 0.08 },
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Lan√ßamento e Constitui√ß√£o do Cr√©dito (arts. 142-150-CTN) / Suspens√£o do Cr√©dito Tribut√°rio (arts. 151-155)", bloco: "Bloco VI", cobranca: 0.072 },
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Extin√ß√£o do Cr√©dito Tribut. (arts. 156-174) / Exclus√£o do Cr√©dito Tribut. (arts. 175-182)", bloco: "Bloco VII", cobranca: 0.068 },
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Legisla√ß√£o Tribut√°ria (arts. 96-112 - CTN) / Obriga√ß√£o Tribut√°ria (arts. 113-118 - CTN)", bloco: "Bloco IV", cobranca: 0.06 },
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Compet√™ncia Tribut√°ria", bloco: "Bloco III", cobranca: 0.056 },
            { disciplina: "DIREITO TRIBUT√ÅRIO", peso: 2, topico: "Impostos de Compet√™ncia dos Munic√≠pios (art. 156 - CF/88)", bloco: "Bloco IX", cobranca: 0.032 },
            
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA ESTADUAL", peso: 2, topico: "ICMS (CF/1988) p1", bloco: "Bloco I", cobranca: 0.39 },
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA ESTADUAL", peso: 2, topico: "ICMS (CF/1988) p2", bloco: "Bloco II", cobranca: 0.39 },
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA ESTADUAL", peso: 2, topico: "SIMPLES Nacional (LC n¬∫ 123/2006)", bloco: "Bloco V", cobranca: 0.17 },
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA ESTADUAL", peso: 2, topico: "IPVA (CF/1988)", bloco: "Bloco III", cobranca: 0.1 },
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA ESTADUAL", peso: 2, topico: "ITCMD (CF/1988)", bloco: "Bloco IV", cobranca: 0.1 },
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA ESTADUAL", peso: 2, topico: "Lei Complementar n¬∫ 24/1975 (CONFAZ) / Lei Complementar n¬∫ 160/2017 (remiss√£o dos cr√©ditos tribut√°rios)", bloco: "Bloco VI", cobranca: 0.08 },
            
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA MUNICIPAL", peso: 2, topico: "ISS (CF/1988)", bloco: "Bloco I", cobranca: 0.315 },
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA MUNICIPAL", peso: 2, topico: "IPTU (CF/1988)", bloco: "Bloco III", cobranca: 0.2 },
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA MUNICIPAL", peso: 2, topico: "SIMPLES Nacional (LC n¬∫ 123/2006)", bloco: "Bloco V", cobranca: 0.15 },
            { disciplina: "LEGISLA√á√ÉO TRIBUT√ÅRIA MUNICIPAL", peso: 2, topico: "ITBI (CF/1988)", bloco: "Bloco IV", cobranca: 0.115 },
            
            { disciplina: "DIREITO ADMINISTRATIVO", peso: 1, topico: "Poderes da administra√ß√£o p√∫blica. / Atos Administrativos.", bloco: "Bloco II", cobranca: 0.095 },
            { disciplina: "DIREITO ADMINISTRATIVO", peso: 1, topico: "Servidores P√∫blicos na CF/88. / Servi√ßos P√∫blicos.", bloco: "Bloco IV", cobranca: 0.074 },
            { disciplina: "DIREITO ADMINISTRATIVO", peso: 1, topico: "Lei n¬∫ 8.429/1992 (LIA).", bloco: "Bloco V", cobranca: 0.074 },
            { disciplina: "DIREITO ADMINISTRATIVO", peso: 1, topico: "Lei n¬∫ 9.784/1999 (Processo Administrativo Federal). / Licita√ß√µes (Lei n¬∫ 14.133/2021)", bloco: "Bloco VI", cobranca: 0.069 },
            { disciplina: "DIREITO ADMINISTRATIVO", peso: 1, topico: "Responsabilidade Civil do Estado. (Jurisprud√™ncia) / Controle da Administra√ß√£o P√∫blica. (Jurisprud√™ncia)", bloco: "Bloco III", cobranca: 0.046 },
            { disciplina: "DIREITO ADMINISTRATIVO", peso: 1, topico: "Princ√≠pios Administrativos. / Organiza√ß√£o Administrativa. / Entidades do 3¬∫ Setor.", bloco: "Bloco I", cobranca: 0.034 },
            
            { disciplina: "DIREITO CIVIL", peso: 1, topico: "Do Direito das Obriga√ß√µes:", bloco: "Bloco VI", cobranca: 0.19 },
            { disciplina: "DIREITO CIVIL", peso: 1, topico: "Bens im√≥veis, m√≥veis e p√∫blicos: / Responsabilidade civil objetiva e subjetiva.", bloco: "Bloco IV", cobranca: 0.161 },
            { disciplina: "DIREITO CIVIL", peso: 1, topico: "Do Direito das Coisas (arts. 1.196 a 1.510) / Dos Direitos Reais (arts. 1.225 a 1.510)", bloco: "Bloco VII", cobranca: 0.16 },
            { disciplina: "DIREITO CIVIL", peso: 1, topico: "Das Pessoas Naturais (arts. 1¬∫ a 39): / Das Pessoas Jur√≠dicas (arts. 40 a 69):", bloco: "Bloco I", cobranca: 0.15 },
            { disciplina: "DIREITO CIVIL", peso: 1, topico: "Lei de Introdu√ß√£o √†s Normas do Direito Brasileiro (LINDB)", bloco: "Bloco VIII", cobranca: 0.11 },
            { disciplina: "DIREITO CIVIL", peso: 1, topico: "Dos Contratos em Geral: / Dos Contratos em Esp√©cie:", bloco: "Bloco V", cobranca: 0.1 },
            { disciplina: "DIREITO CIVIL", peso: 1, topico: "Prescri√ß√£o. Decad√™ncia.", bloco: "Bloco III", cobranca: 0.08 },
            { disciplina: "DIREITO CIVIL", peso: 1, topico: "Neg√≥cio Jur√≠dico (arts. 104 a 184): / Prescri√ß√£o. Decad√™ncia.", bloco: "Bloco II", cobranca: 0.06 },
            
            { disciplina: "DIREITO CONSTITUCIONAL", peso: 1, topico: "Controle de Constitucionalidade / Efic√°cia das Normas Constitucionais", bloco: "Bloco IX", cobranca: 0.115 },
            { disciplina: "DIREITO CONSTITUCIONAL", peso: 1, topico: "Direitos e Garantias Fundamentais (arts. 5-17) p1", bloco: "Bloco I", cobranca: 0.093 },
            { disciplina: "DIREITO CONSTITUCIONAL", peso: 1, topico: "Do Poder Legislativo (arts. 44 a 75):/ Do Processo Legislativo (arts. 59 a 69): / Da Fiscaliza√ß√£o COFOP (arts. 70 a 75)", bloco: "Bloco V", cobranca: 0.092 },
            { disciplina: "DIREITO CONSTITUCIONAL", peso: 1, topico: "Do Poder Executivo (arts. 76 a 91): / Poder Judici√°rio (arts. 92 a 105):", bloco: "Bloco VI", cobranca: 0.092 },
            { disciplina: "DIREITO CONSTITUCIONAL", peso: 1, topico: "Do Sistema Tribut√°rio Nacional (arts. 145 a 162):/ Das Finan√ßas P√∫blicas (arts. 163 a 169):", bloco: "Bloco VII", cobranca: 0.087 },
            { disciplina: "DIREITO CONSTITUCIONAL", peso: 1, topico: "Direitos e Garantias Fundamentais (arts. 5-17) p2", bloco: "Bloco II", cobranca: 0.065 },
            { disciplina: "DIREITO CONSTITUCIONAL", peso: 1, topico: "Da Administra√ß√£o P√∫blica (arts. 37 a 41)", bloco: "Bloco IV", cobranca: 0.054 },
            { disciplina: "DIREITO CONSTITUCIONAL", peso: 1, topico: "Da Organiza√ß√£o do Estado (arts. 18 a 36)", bloco: "Bloco III", cobranca: 0.049 },
            { disciplina: "DIREITO CONSTITUCIONAL", peso: 1, topico: "Da Ordem econ√¥mica e financeira (arts. 170 a 192)", bloco: "Bloco VIII", cobranca: 0.044 },
            
            { disciplina: "DIREITO EMPRESARIAL", peso: 1, topico: "Do Empres√°rio (arts. 966 a 980 do CC)", bloco: "Bloco I", cobranca: 0.231 },
            { disciplina: "DIREITO EMPRESARIAL", peso: 1, topico: "Sociedade Limitada (arts. 1.052 a 1.087 do CC)", bloco: "Bloco III", cobranca: 0.143 },
            { disciplina: "DIREITO EMPRESARIAL", peso: 1, topico: "Sociedades N√£o Personificadas (arts. 986 a 996 do CC): / Sociedade Personificada (arts. 997 a 1.141 do CC)", bloco: "Bloco II", cobranca: 0.088 },
            
            { disciplina: "DIREITO PENAL", peso: 1, topico: "Dos Crimes contra a Administra√ß√£o P√∫blica (arts. 312 a 337-A - C√≥digo Penal): / Dos Crimes praticados por Funcion√°rio P√∫blico (arts. 312 a 327 do CP)", bloco: "Bloco I", cobranca: 0.472 },
            { disciplina: "DIREITO PENAL", peso: 1, topico: "Da Teoria do Crime / O fato t√≠pico e seus elementos / Concurso de crimes. Ilicitude e causas de exclus√£o. / Culpabilidade. Elementos e causas de exclus√£o.", bloco: "Bloco VI", cobranca: 0.197 },
            { disciplina: "DIREITO PENAL", peso: 1, topico: "Dos Crimes contra a F√© P√∫blica (arts. 293 a 311-A - C√≥digo Penal): / Da Falsidade Documental (arts. 296-305-CP)", bloco: "Bloco IV", cobranca: 0.163 },
            { disciplina: "DIREITO PENAL", peso: 1, topico: "Lei n¬∫ 8.137/1990 - Crimes contra a Ordem Tribut√°ria, Econ√¥mica e Rela√ß√µes de Consumo", bloco: "Bloco III", cobranca: 0.157 },
            { disciplina: "DIREITO PENAL", peso: 1, topico: "Da Aplica√ß√£o da Lei penal (arts. 01¬∞ ao 12 do CP) e Princ√≠pios do Direito Penal.", bloco: "Bloco V", cobranca: 0.101 },
            
            { disciplina: "PORTUGU√äS", peso: 1, topico: "Interpreta√ß√£o e Compreens√£o de Textos p1", bloco: "Bloco VI", cobranca: 0.35 },
            { disciplina: "PORTUGU√äS", peso: 1, topico: "Interpreta√ß√£o e Compreens√£o de Textos p2", bloco: "Bloco VIII", cobranca: 0.35 },
            { disciplina: "PORTUGU√äS", peso: 1, topico: "Interpreta√ß√£o e Compreens√£o de Textos p3", bloco: "Bloco VIII", cobranca: 0.35 },
            { disciplina: "PORTUGU√äS", peso: 1, topico: "Concord√¢ncia (Verbal e Nominal)", bloco: "Bloco IV", cobranca: 0.057 },
            { disciplina: "PORTUGU√äS", peso: 1, topico: "Reescrita de Frases (Substitui√ß√£o de palavras/ trechos de texto).", bloco: "Bloco V", cobranca: 0.051 }
        ];

        // ========== VARI√ÅVEIS GLOBAIS ==========
        let appData = [];
        let usuarioAtual = null;
        let graficos = {};
        let filtroHojeAtivo = false;
        let metaSemanal = 500;
        
        const REVISOES = [1, 7, 15, 30, 60, 90];
        const NOMES_REV = ['R1', 'R7', 'R15', 'R30', 'R60', 'R90'];

        // ========== FUN√á√ÉO PARA CRIAR DADOS DA PLANILHA ==========
        function criarDadosDaPlanilha() {
            const disciplinasMap = new Map();
            
            DADOS_PLANILHA.forEach(item => {
                if (!disciplinasMap.has(item.disciplina)) {
                    disciplinasMap.set(item.disciplina, {
                        id: 'd' + Date.now() + Math.random() + item.disciplina.substring(0,3),
                        nome: item.disciplina,
                        peso: item.peso,
                        expandido: true,
                        topicos: []
                    });
                }
                
                const disciplina = disciplinasMap.get(item.disciplina);
                
                // Formatar t√≥pico com bloco
                const nomeCompleto = `${item.topico} - ${item.bloco}`;
                
                disciplina.topicos.push({
                    id: 'c' + Date.now() + Math.random() + item.topico.substring(0,3),
                    nome: nomeCompleto,
                    relevancia: Math.round(item.cobranca * 100), // Converter para percentual
                    link: '',
                    questoes: 0,
                    acertos: 0,
                    data: '',
                    revisoes: [0, 0, 0, 0, 0, 0],
                    revQuestoes: [0, 0, 0, 0, 0, 0],
                    revAcertos: [0, 0, 0, 0, 0, 0],
                    sm2: {
                        intervalo: 0,
                        fator: 2.5,
                        proximaRevisao: null
                    }
                });
            });
            
            return Array.from(disciplinasMap.values());
        }

        // ========== INICIALIZA√á√ÉO ==========
        function carregarDados() {
            const salvos = localStorage.getItem('neuroai_dados_tecconcursos');
            if (salvos) {
                try {
                    appData = JSON.parse(salvos);
                } catch (e) {
                    appData = criarDadosDaPlanilha();
                }
            } else {
                appData = criarDadosDaPlanilha();
            }
            
            const metaSalva = localStorage.getItem('neuroai_meta_90d');
            if (metaSalva) metaSemanal = parseInt(metaSalva);
            
            atualizarTudo();
        }

        // ========== AUTENTICA√á√ÉO ==========
        window.login = function() {
            auth.signInWithPopup(provider)
                .catch(error => alert('Erro ao logar: ' + error.message));
        };

        window.logout = function() {
            auth.signOut();
        };

        auth.onAuthStateChanged(usuario => {
            usuarioAtual = usuario;
            
            const loginBtn = document.getElementById('loginBtn');
            const userInfo = document.getElementById('userInfo');
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const syncStatus = document.getElementById('syncStatus');
            const syncText = document.getElementById('syncText');
            
            if (usuario) {
                loginBtn.style.display = 'none';
                userInfo.style.display = 'flex';
                userAvatar.src = usuario.photoURL || '';
                userName.textContent = usuario.displayName?.split(' ')[0] || 'Usu√°rio';
                
                syncStatus.style.background = '#34d399';
                syncText.textContent = 'Sincronizado';
                syncText.style.color = '#34d399';
                
                carregarDadosNuvem();
            } else {
                loginBtn.style.display = 'block';
                userInfo.style.display = 'none';
                
                syncStatus.style.background = '#6b7280';
                syncText.textContent = 'Offline';
                syncText.style.color = '#6b7280';
                
                carregarDados();
            }
        });

        async function carregarDadosNuvem() {
            if (!usuarioAtual) return;
            try {
                const doc = await db.collection('usuarios').doc(usuarioAtual.uid).get();
                if (doc.exists && doc.data().dados) {
                    appData = doc.data().dados;
                    localStorage.setItem('neuroai_dados_tecconcursos', JSON.stringify(appData));
                    atualizarTudo();
                }
            } catch (error) {
                console.error('Erro ao carregar da nuvem:', error);
            }
        }

        async function salvarDadosNuvem() {
            if (!usuarioAtual) return;
            try {
                await db.collection('usuarios').doc(usuarioAtual.uid).set({
                    dados: appData,
                    ultimaAtualizacao: new Date().toISOString()
                });
                document.getElementById('syncStatus').style.background = '#34d399';
            } catch (error) {
                console.error('Erro ao salvar:', error);
                document.getElementById('syncStatus').style.background = '#ef4444';
            }
        }

        // ========== FUN√á√ïES DE C√ÅLCULO ==========
        function calcularEstatisticas() {
            let totalQuestoes = 0;
            let totalAcertos = 0;
            let revisoesHoje = 0;
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const statsPorDisciplina = {};
            const revisoesPorDia = [0, 0, 0, 0, 0, 0];
            
            appData.forEach(disciplina => {
                if (!statsPorDisciplina[disciplina.nome]) {
                    statsPorDisciplina[disciplina.nome] = { 
                        questoes: 0, 
                        acertos: 0,
                        peso: disciplina.peso || 1
                    };
                }
                
                disciplina.topicos.forEach(topico => {
                    totalQuestoes += topico.questoes || 0;
                    totalAcertos += topico.acertos || 0;
                    
                    statsPorDisciplina[disciplina.nome].questoes += topico.questoes || 0;
                    statsPorDisciplina[disciplina.nome].acertos += topico.acertos || 0;
                    
                    if (topico.data) {
                        const dataBase = new Date(topico.data);
                        dataBase.setHours(0, 0, 0, 0);
                        
                        REVISOES.forEach((dias, idx) => {
                            const dataRev = new Date(dataBase);
                            dataRev.setDate(dataRev.getDate() + dias);
                            dataRev.setHours(0, 0, 0, 0);
                            
                            if (dataRev <= hoje && !topico.revisoes[idx]) {
                                revisoesHoje++;
                                revisoesPorDia[idx]++;
                            }
                        });
                    }
                });
            });
            
            return {
                totalQuestoes,
                totalAcertos,
                revisoesHoje,
                revisoesPorDia,
                desempenho: totalQuestoes > 0 ? (totalAcertos / totalQuestoes * 100) : 0,
                statsPorDisciplina
            };
        }

        // ========== ALGORITMO SM-2 ==========
        function aplicarSM2(topico, qualidade) {
            if (!topico.sm2) {
                topico.sm2 = { intervalo: 0, fator: 2.5, proximaRevisao: null };
            }
            
            const sm2 = topico.sm2;
            
            if (qualidade === 0) { // Dif√≠cil
                sm2.intervalo = 1;
                sm2.fator = Math.max(1.3, sm2.fator - 0.2);
            } else if (qualidade === 1) { // M√©dio
                if (sm2.intervalo === 0) sm2.intervalo = 1;
                else if (sm2.intervalo === 1) sm2.intervalo = 6;
                else sm2.intervalo = Math.round(sm2.intervalo * sm2.fator);
            } else { // F√°cil
                if (sm2.intervalo === 0) sm2.intervalo = 1;
                else if (sm2.intervalo === 1) sm2.intervalo = 6;
                else sm2.intervalo = Math.round(sm2.intervalo * sm2.fator);
                sm2.fator = Math.min(2.5, sm2.fator + 0.15);
            }
            
            const hoje = new Date();
            const proxima = new Date(hoje);
            proxima.setDate(hoje.getDate() + sm2.intervalo);
            sm2.proximaRevisao = proxima.toISOString().split('T')[0];
            
            salvarDados();
        }

        // ========== RENDERIZA√á√ÉO TABELA ==========
        function desenharTabela() {
            const tbody = document.getElementById('tabelaBody');
            if (!tbody) return;
            
            let html = '';
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            appData.forEach(disciplina => {
                // Linha da disciplina
                if (!filtroHojeAtivo) {
                    html += `
                        <tr class="tr-disciplina">
                            <td onclick="toggleDisciplina('${disciplina.id}')" style="cursor: pointer; text-align: center;">
                                ${disciplina.expandido ? '‚ñº' : '‚ñ∂'}
                            </td>
                            <td>
                                <div class="flex items-center gap-2">
                                    <input class="input-clean font-bold" value="${disciplina.nome}" 
                                        onblur="atualizarDisciplina('${disciplina.id}', 'nome', this.value)">
                                    <button class="btn-add-topico" onclick="addTopico('${disciplina.id}')">+ T√≥pico</button>
                                </div>
                            </td>
                            <td></td>
                            <td class="text-center">
                                <select class="input-clean text-center w-16" onchange="atualizarDisciplina('${disciplina.id}', 'peso', this.value)">
                                    <option value="3" ${disciplina.peso === 3 ? 'selected' : ''}>3</option>
                                    <option value="2" ${disciplina.peso === 2 ? 'selected' : ''}>2</option>
                                    <option value="1" ${disciplina.peso === 1 ? 'selected' : ''}>1</option>
                                </select>
                            </td>
                            <td colspan="20"></td>
                        </tr>
                    `;
                }
                
                // T√≥picos
                if (disciplina.expandido || filtroHojeAtivo) {
                    disciplina.topicos.forEach(topico => {
                        if (filtroHojeAtivo) {
                            let temRevisaoHoje = false;
                            if (topico.data) {
                                const dataBase = new Date(topico.data);
                                dataBase.setHours(0, 0, 0, 0);
                                
                                REVISOES.forEach((dias, idx) => {
                                    const dataRev = new Date(dataBase);
                                    dataRev.setDate(dataRev.getDate() + dias);
                                    dataRev.setHours(0, 0, 0, 0);
                                    if (dataRev <= hoje && !topico.revisoes[idx]) {
                                        temRevisaoHoje = true;
                                    }
                                });
                            }
                            if (!temRevisaoHoje) return;
                        }
                        
                        const perc = topico.questoes > 0 ? Math.round(topico.acertos / topico.questoes * 100) : 0;
                        const percClass = perc >= 70 ? 'text-green-400' : perc >= 50 ? 'text-yellow-400' : 'text-red-400';
                        
                        let relevanciaClass = 'relevancia-baixa';
                        if (topico.relevancia >= 20) relevanciaClass = 'relevancia-alta';
                        else if (topico.relevancia >= 10) relevanciaClass = 'relevancia-media';
                        
                        html += `
                            <tr>
                                <td></td>
                                <td>
                                    <div class="flex items-center gap-2">
                                        <input class="input-clean" value="${topico.nome}" 
                                            onblur="atualizarTopico('${disciplina.id}', '${topico.id}', 'nome', this.value)">
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="flex flex-col items-center">
                                        <span class="relevancia-badge ${relevanciaClass}">${topico.relevancia || 0}%</span>
                                        <input type="range" min="0" max="100" value="${topico.relevancia || 0}" 
                                            onchange="atualizarTopico('${disciplina.id}', '${topico.id}', 'relevancia', this.value)"
                                            style="width: 60px;" class="mt-1">
                                    </div>
                                </td>
                                <td></td>
                                <td class="text-center">
                                    <input class="input-mini" value="${topico.questoes || 0}" 
                                        onchange="atualizarTopico('${disciplina.id}', '${topico.id}', 'questoes', this.value)">
                                </td>
                                <td class="text-center">
                                    <input class="input-mini" value="${topico.acertos || 0}" 
                                        onchange="atualizarTopico('${disciplina.id}', '${topico.id}', 'acertos', this.value)">
                                </td>
                                <td class="text-center font-bold ${percClass}">${perc}%</td>
                                <td class="text-center">
                                    <div class="flex items-center gap-1">
                                        <input class="input-clean text-xs" placeholder="Link TEC" value="${topico.link || ''}" 
                                            onblur="atualizarTopico('${disciplina.id}', '${topico.id}', 'link', this.value)">
                                        ${topico.link ? `<a href="${topico.link}" target="_blank" class="link-tec">üîó</a>` : ''}
                                    </div>
                                </td>
                                <td class="text-center">
                                    <input type="checkbox" ${topico.data ? 'checked' : ''} 
                                        onchange="marcarData('${disciplina.id}', '${topico.id}', this.checked)"
                                        style="width: 18px; height: 18px;">
                                </td>
                        `;
                        
                        // 6 revis√µes com QTD, AC e %
                        for (let i = 0; i < 6; i++) {
                            const statusClass = topico.revisoes[i] ? 'done' : 
                                (topico.data && new Date(new Date(topico.data).getTime() + REVISOES[i]*24*60*60*1000) <= hoje ? 'pending' : 'future');
                            
                            const revPerc = topico.revQuestoes[i] > 0 ? Math.round(topico.revAcertos[i] / topico.revQuestoes[i] * 100) : 0;
                            const revPercClass = revPerc >= 70 ? 'text-green-400' : revPerc >= 50 ? 'text-yellow-400' : 'text-red-400';
                            
                            html += `
                                <td class="text-center rev-r${REVISOES[i]}" style="padding: 4px 2px;">
                                    <div class="status-dot ${statusClass}" 
                                        onclick="marcarRevisao('${disciplina.id}', '${topico.id}', ${i})"
                                        title="${NOMES_REV[i]}"></div>
                                </td>
                                <td class="text-center rev-r${REVISOES[i]}" style="padding: 4px 2px;">
                                    <input class="input-micro" value="${topico.revQuestoes[i] || 0}" 
                                        onchange="atualizarRevQuestao('${disciplina.id}', '${topico.id}', ${i}, this.value)">
                                </td>
                                <td class="text-center rev-r${REVISOES[i]}" style="padding: 4px 2px;">
                                    <div class="flex flex-col items-center">
                                        <input class="input-micro" value="${topico.revAcertos[i] || 0}" 
                                            onchange="atualizarRevAcerto('${disciplina.id}', '${topico.id}', ${i}, this.value)">
                                        <span class="revisao-percent ${revPercClass}">${revPerc}%</span>
                                    </div>
                                </td>
                            `;
                        }
                        
                        // SM-2 Buttons
                        html += `
                                <td class="text-center">
                                    <div class="sm2-buttons">
                                        <button class="sm2-btn hard" onclick="aplicarSM2Cliente('${disciplina.id}', '${topico.id}', 0)" title="Dif√≠cil">!</button>
                                        <button class="sm2-btn medium" onclick="aplicarSM2Cliente('${disciplina.id}', '${topico.id}', 1)" title="M√©dio">~</button>
                                        <button class="sm2-btn easy" onclick="aplicarSM2Cliente('${disciplina.id}', '${topico.id}', 2)" title="F√°cil">‚úì</button>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        ${topico.sm2?.proximaRevisao ? 'Pr√≥x: ' + new Date(topico.sm2.proximaRevisao).toLocaleDateString() : ''}
                                    </div>
                                </td>
                                <td class="text-center">
                                    <button class="text-red-400 hover:text-red-300" onclick="deletarTopico('${disciplina.id}', '${topico.id}')">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            });
            
            if (filtroHojeAtivo && html === '') {
                html = '<tr><td colspan="30" class="text-center py-8 text-gray-500">üéØ Nenhuma revis√£o pendente para hoje</td></tr>';
            }
            
            tbody.innerHTML = html;
        }

        // ========== FUN√á√ïES DE A√á√ÉO ==========
        window.addTopico = function(disciplinaId) {
            const disciplina = appData.find(d => d.id === disciplinaId);
            if (!disciplina) return;
            
            const novoTopico = {
                id: 'c' + Date.now() + Math.random(),
                nome: 'Novo T√≥pico - Bloco ?',
                relevancia: 10,
                link: '',
                questoes: 0,
                acertos: 0,
                data: '',
                revisoes: [0, 0, 0, 0, 0, 0],
                revQuestoes: [0, 0, 0, 0, 0, 0],
                revAcertos: [0, 0, 0, 0, 0, 0],
                sm2: {
                    intervalo: 0,
                    fator: 2.5,
                    proximaRevisao: null
                }
            };
            
            disciplina.topicos.push(novoTopico);
            disciplina.expandido = true;
            salvarDados();
            desenharTabela();
        };

        window.toggleDisciplina = function(id) {
            const disc = appData.find(d => d.id === id);
            if (disc) {
                disc.expandido = !disc.expandido;
                desenharTabela();
                salvarDados();
            }
        };

        window.atualizarDisciplina = function(id, campo, valor) {
            const disc = appData.find(d => d.id === id);
            if (disc) {
                disc[campo] = campo === 'peso' ? parseInt(valor) : valor;
                salvarDados();
            }
        };

        window.atualizarTopico = function(discId, topId, campo, valor) {
            const disc = appData.find(d => d.id === discId);
            const top = disc?.topicos.find(t => t.id === topId);
            if (top) {
                if (campo === 'questoes' || campo === 'acertos' || campo === 'relevancia') {
                    top[campo] = parseInt(valor) || 0;
                } else {
                    top[campo] = valor;
                }
                salvarDados();
                atualizarDashboard();
            }
        };

        window.atualizarRevQuestao = function(discId, topId, index, valor) {
            const disc = appData.find(d => d.id === discId);
            const top = disc?.topicos.find(t => t.id === topId);
            if (top) {
                top.revQuestoes[index] = parseInt(valor) || 0;
                salvarDados();
                desenharTabela();
                atualizarDashboard();
            }
        };

        window.atualizarRevAcerto = function(discId, topId, index, valor) {
            const disc = appData.find(d => d.id === discId);
            const top = disc?.topicos.find(t => t.id === topId);
            if (top) {
                top.revAcertos[index] = parseInt(valor) || 0;
                salvarDados();
                desenharTabela();
                atualizarDashboard();
            }
        };

        window.marcarData = function(discId, topId, checked) {
            const disc = appData.find(d => d.id === discId);
            const top = disc?.topicos.find(t => t.id === topId);
            if (top) {
                top.data = checked ? new Date().toISOString().split('T')[0] : '';
                salvarDados();
                desenharTabela();
                atualizarDashboard();
            }
        };

        window.marcarRevisao = function(discId, topId, index) {
            const disc = appData.find(d => d.id === discId);
            const top = disc?.topicos.find(t => t.id === topId);
            if (top) {
                top.revisoes[index] = top.revisoes[index] ? 0 : 1;
                salvarDados();
                desenharTabela();
                atualizarDashboard();
            }
        };

        window.aplicarSM2Cliente = function(discId, topId, qualidade) {
            const disc = appData.find(d => d.id === discId);
            const top = disc?.topicos.find(t => t.id === topId);
            if (top) {
                aplicarSM2(top, qualidade);
                desenharTabela();
                atualizarDashboard();
            }
        };

        window.deletarTopico = function(discId, topId) {
            if (!confirm('Excluir este t√≥pico?')) return;
            const disc = appData.find(d => d.id === discId);
            if (disc) {
                disc.topicos = disc.topicos.filter(t => t.id !== topId);
                salvarDados();
                desenharTabela();
                atualizarDashboard();
            }
        };

        window.showAddDisciplina = function() {
            document.getElementById('addForm').style.display = 'flex';
        };

        window.hideAddDisciplina = function() {
            document.getElementById('addForm').style.display = 'none';
        };

        window.addDisciplina = function() {
            const nome = document.getElementById('novaDisciplina').value.trim();
            const peso = document.getElementById('pesoDisciplina').value;
            
            if (!nome) return;
            
            appData.push({
                id: 'd' + Date.now() + '_' + Math.random(),
                nome: nome,
                peso: parseInt(peso),
                expandido: true,
                topicos: []
            });
            
            document.getElementById('novaDisciplina').value = '';
            document.getElementById('addForm').style.display = 'none';
            
            salvarDados();
            desenharTabela();
        };

        window.toggleFiltroHoje = function() {
            filtroHojeAtivo = !filtroHojeAtivo;
            const btn = document.getElementById('btnHoje');
            btn.style.background = filtroHojeAtivo ? 'rgba(66, 133, 244, 0.2)' : '';
            btn.style.borderColor = filtroHojeAtivo ? '#4285f4' : '';
            desenharTabela();
        };

        // ========== DASHBOARD ==========
        function atualizarDashboard() {
            const stats = calcularEstatisticas();
            
            document.getElementById('kpiTotal').textContent = stats.totalQuestoes;
            document.getElementById('kpiPerf').textContent = stats.desempenho.toFixed(1) + '%';
            document.getElementById('kpiRev').textContent = stats.revisoesHoje;
            
            let totalRevisoesPrevistas = 0;
            let totalRevisoesFeitas = 0;
            appData.forEach(d => {
                d.topicos.forEach(t => {
                    if (t.data) {
                        totalRevisoesPrevistas += 6;
                        totalRevisoesFeitas += t.revisoes.reduce((a,b) => a + b, 0);
                    }
                });
            });
            const progresso90 = totalRevisoesPrevistas > 0 ? (totalRevisoesFeitas / totalRevisoesPrevistas * 100) : 0;
            document.getElementById('kpi90d').textContent = progresso90.toFixed(0) + '%';
            
            desenharHeatmap();
            calcularUltimos7Dias();
            atualizarGraficos(stats);
            verificarAlertasRevisoes(stats);
        }

        function desenharHeatmap() {
            const container = document.getElementById('heatmap');
            if (!container) return;
            
            const hoje = new Date();
            let html = '';
            
            for (let i = 29; i >= 0; i--) {
                const data = new Date();
                data.setDate(hoje.getDate() - i);
                const dataStr = data.toISOString().split('T')[0];
                
                let questoes = 0;
                appData.forEach(d => {
                    d.topicos.forEach(t => {
                        if (t.data === dataStr) {
                            questoes += t.questoes || 0;
                        }
                    });
                });
                
                let cor = '#2a2b2e';
                if (questoes > 0) {
                    if (questoes < 5) cor = '#0b4f2c';
                    else if (questoes < 10) cor = '#0e6a3a';
                    else if (questoes < 15) cor = '#118c4a';
                    else if (questoes < 20) cor = '#14a85a';
                    else cor = '#34d399';
                }
                
                html += `<div class="heatmap-cell" style="background: ${cor}" title="${dataStr}: ${questoes} quest√µes"></div>`;
            }
            
            container.innerHTML = html;
        }

        function calcularUltimos7Dias() {
            const hoje = new Date();
            let total = 0, acertos = 0;
            const dadosDiarios = [];
            
            for (let i = 6; i >= 0; i--) {
                const data = new Date();
                data.setDate(hoje.getDate() - i);
                const dataStr = data.toISOString().split('T')[0];
                
                let diaQuestoes = 0;
                let diaAcertos = 0;
                
                appData.forEach(d => {
                    d.topicos.forEach(t => {
                        if (t.data === dataStr) {
                            diaQuestoes += t.questoes || 0;
                            diaAcertos += t.acertos || 0;
                        }
                    });
                });
                
                total += diaQuestoes;
                acertos += diaAcertos;
                dadosDiarios.push(diaQuestoes);
            }
            
            const desempenho = total > 0 ? (acertos / total * 100).toFixed(1) : 0;
            
            document.getElementById('perf7d').textContent = desempenho + '%';
            document.getElementById('total7d').textContent = total;
            document.getElementById('acertos7d').textContent = acertos;
            document.getElementById('erros7d').textContent = total - acertos;
            
            if (graficos.evolucao) {
                graficos.evolucao.data.datasets[0].data = dadosDiarios;
                graficos.evolucao.update();
            }
        }

        function atualizarGraficos(stats) {
            const ctxDisc = document.getElementById('chartDisciplinas')?.getContext('2d');
            if (ctxDisc) {
                const labels = Object.keys(stats.statsPorDisciplina);
                const dados = labels.map(l => {
                    const d = stats.statsPorDisciplina[l];
                    return d.questoes > 0 ? (d.acertos / d.questoes * 100) : 0;
                });
                
                if (graficos.disciplinas) graficos.disciplinas.destroy();
                
                graficos.disciplinas = new Chart(ctxDisc, {
                    type: 'bar',
                    data: { labels, datasets: [{ label: 'Desempenho %', data: dados, backgroundColor: '#4285f4' }] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { max: 100, grid: { color: '#2f3336' } } } }
                });
            }
            
            const ctxRev = document.getElementById('chartRevisoes')?.getContext('2d');
            if (ctxRev) {
                if (graficos.revisoes) graficos.revisoes.destroy();
                
                graficos.revisoes = new Chart(ctxRev, {
                    type: 'doughnut',
                    data: {
                        labels: NOMES_REV,
                        datasets: [{ data: stats.revisoesPorDia, backgroundColor: ['#4285f4', '#fbbc04', '#ea4335', '#34a853', '#8b5cf6', '#ec4899'] }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }
            
            const ctxEvo = document.getElementById('chartEvolucao')?.getContext('2d');
            if (ctxEvo) {
                if (graficos.evolucao) graficos.evolucao.destroy();
                
                graficos.evolucao = new Chart(ctxEvo, {
                    type: 'line',
                    data: { labels: ['D-6','D-5','D-4','D-3','D-2','D-1','Hoje'], datasets: [{ data: [0,0,0,0,0,0,0], borderColor: '#8b5cf6', borderWidth: 2, pointRadius: 2, tension: 0.4 }] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { display: false } }, plugins: { legend: { display: false } } }
                });
            }
        }

        function verificarAlertasRevisoes(stats) {
            const alerta = document.getElementById('revisoesAlert');
            if (stats.revisoesHoje > 0) {
                alerta.style.display = 'flex';
                document.getElementById('revisoesText').textContent = 
                    `Voc√™ tem ${stats.revisoesHoje} revis√µes pendentes para hoje`;
            } else {
                alerta.style.display = 'none';
            }
            
            document.getElementById('countR1').textContent = stats.revisoesPorDia[0];
            document.getElementById('countR7').textContent = stats.revisoesPorDia[1];
            document.getElementById('countR15').textContent = stats.revisoesPorDia[2];
            document.getElementById('countR30').textContent = stats.revisoesPorDia[3];
            document.getElementById('countR60').textContent = stats.revisoesPorDia[4];
            document.getElementById('countR90').textContent = stats.revisoesPorDia[5];
        }

        // ========== METAS ==========
        function atualizarMetas() {
            const stats = calcularEstatisticas();
            
            document.getElementById('progressoMeta').textContent = `${stats.totalQuestoes} / ${metaSemanal}`;
            const percentualMeta = Math.min(100, (stats.totalQuestoes / metaSemanal * 100));
            document.getElementById('barraProgresso').style.width = percentualMeta + '%';
            
            const diasDesdeInicio = calcularDiasDesdePrimeiroEstudo();
            const progressoCiclo = Math.min(100, (diasDesdeInicio / 90 * 100));
            document.getElementById('progressoCiclo').textContent = progressoCiclo.toFixed(0) + '%';
            document.getElementById('barraCiclo').style.width = progressoCiclo + '%';
            
            const diasRestantes = Math.max(0, 90 - diasDesdeInicio);
            document.getElementById('previsaoEdital').textContent = diasRestantes + ' dias';
        }

        function calcularDiasDesdePrimeiroEstudo() {
            let primeiraData = null;
            appData.forEach(d => {
                d.topicos.forEach(t => {
                    if (t.data) {
                        const data = new Date(t.data);
                        if (!primeiraData || data < primeiraData) {
                            primeiraData = data;
                        }
                    }
                });
            });
            
            if (!primeiraData) return 0;
            
            const hoje = new Date();
            const diffTime = Math.abs(hoje - primeiraData);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        window.atualizarMeta = function() {
            const input = document.getElementById('metaInput');
            metaSemanal = parseInt(input.value) || 500;
            localStorage.setItem('neuroai_meta_90d', metaSemanal);
            atualizarMetas();
        };

        // ========== FUN√á√ïES IA (SIMULADA) ==========
        window.consultCoach = function() {
            const stats = calcularEstatisticas();
            const feedback = document.getElementById('coachFeedback');
            const coachText = document.getElementById('coachText');
            
            feedback.style.display = 'block';
            coachText.innerHTML = '<div class="spinner w-4 h-4 inline-block mr-2"></div>Analisando...';
            
            setTimeout(() => {
                let diagnostico = '';
                if (stats.desempenho < 50) {
                    diagnostico = 'üî¥ Base te√≥rica fraca. Foque em revis√£o antes de novas quest√µes.';
                } else if (stats.desempenho < 70) {
                    diagnostico = 'üü° Conhecimento m√©dio. Priorize as revis√µes R1 e R7.';
                } else {
                    diagnostico = 'üü¢ Bom desempenho! Hora de avan√ßar para quest√µes mais complexas.';
                }
                
                coachText.innerHTML = `
                    <p><strong>üìä Diagn√≥stico:</strong> ${diagnostico}</p>
                    <p class="mt-2"><strong>üéØ Prioridade hoje:</strong> ${stats.revisoesHoje} revis√µes pendentes</p>
                    <p class="mt-2"><strong>üìÖ Ciclo 90 dias:</strong> ${calcularDiasDesdePrimeiroEstudo()} dias estudando</p>
                `;
            }, 1000);
        };

        window.analisarPrioridades = function() {
            const prioridades = [];
            
            appData.forEach(d => {
                d.topicos.forEach(t => {
                    const perc = t.questoes > 0 ? (t.acertos / t.questoes * 100) : 0;
                    const peso = d.peso || 1;
                    const relevancia = t.relevancia || 0;
                    
                    if (t.questoes > 0 && perc < 60) {
                        prioridades.push({
                            disciplina: d.nome,
                            topico: t.nome,
                            perc: Math.round(perc),
                            peso: peso,
                            relevancia: relevancia,
                            urgencia: (100 - perc) * peso * (relevancia / 100)
                        });
                    }
                });
            });
            
            prioridades.sort((a, b) => b.urgencia - a.urgencia);
            
            let html = '<h3 class="text-lg font-bold mb-4">üìã Prioridades de Estudo</h3>';
            
            if (prioridades.length === 0) {
                html += '<p>Parab√©ns! Nenhuma prioridade cr√≠tica identificada üéâ</p>';
            } else {
                prioridades.slice(0, 5).forEach(p => {
                    html += `
                        <div class="p-3 bg-gray-800 rounded mb-2">
                            <div class="text-sm text-blue-400">${p.disciplina}</div>
                            <div class="font-medium">${p.topico}</div>
                            <div class="text-xs ${p.perc < 40 ? 'text-red-400' : 'text-yellow-400'} mt-1">${p.perc}% acerto ¬∑ Relev√¢ncia ${p.relevancia}% ¬∑ Peso ${p.peso}</div>
                        </div>
                    `;
                });
            }
            
            abrirModal('Prioridades IA', html);
        };

        window.mostrarRevisoesHoje = function() {
            const stats = calcularEstatisticas();
            const hoje = new Date();
            hoje.setHours(0,0,0,0);
            
            let html = '<h3 class="text-lg font-bold mb-4">üìÖ Revis√µes para hoje</h3>';
            let encontrou = false;
            
            appData.forEach(d => {
                d.topicos.forEach(t => {
                    if (t.data) {
                        const dataBase = new Date(t.data);
                        dataBase.setHours(0,0,0,0);
                        
                        REVISOES.forEach((dias, idx) => {
                            const dataRev = new Date(dataBase);
                            dataRev.setDate(dataRev.getDate() + dias);
                            dataRev.setHours(0,0,0,0);
                            
                            if (dataRev <= hoje && !t.revisoes[idx]) {
                                encontrou = true;
                                html += `
                                    <div class="p-3 bg-gray-800 rounded mb-2">
                                        <div class="flex justify-between">
                                            <span class="text-sm" style="color: ${idx === 0 ? '#4285f4' : idx === 1 ? '#fbbc04' : idx === 2 ? '#ea4335' : idx === 3 ? '#34a853' : idx === 4 ? '#8b5cf6' : '#ec4899'}">
                                                ${NOMES_REV[idx]}
                                            </span>
                                            <span class="text-xs text-gray-500">${d.nome}</span>
                                        </div>
                                        <div class="font-medium">${t.nome}</div>
                                        <button class="btn btn-ai text-xs mt-2" onclick="marcarRevisao('${d.id}', '${t.id}', ${idx}); fecharModal();">Marcar como revisado</button>
                                    </div>
                                `;
                            }
                        });
                    }
                });
            });
            
            if (!encontrou) html += '<p class="text-gray-400">Nenhuma revis√£o pendente! üéâ</p>';
            
            abrirModal('Revis√µes do dia', html);
        };

        // ========== EXPORTA√á√ÉO ==========
        window.exportarDados = function() {
            const dadosExport = {
                data: appData,
                meta: metaSemanal,
                dataExport: new Date().toISOString(),
                versao: '2.0'
            };
            
            const blob = new Blob([JSON.stringify(dadosExport, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `neuroai_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        };

        // ========== UTILIT√ÅRIOS ==========
        window.showTab = function(tab) {
            document.getElementById('dashboardView').style.display = tab === 'dashboard' ? 'block' : 'none';
            document.getElementById('estudosView').style.display = tab === 'estudos' ? 'block' : 'none';
            document.getElementById('metasView').style.display = tab === 'metas' ? 'block' : 'none';
            document.getElementById('revisoesView').style.display = tab === 'revisoes' ? 'block' : 'none';
            
            ['dashboard', 'estudos', 'metas', 'revisoes'].forEach(t => {
                const el = document.getElementById(`tab${t.charAt(0).toUpperCase() + t.slice(1)}`);
                if (el) el.classList.remove('active');
            });
            
            const activeTab = document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
            if (activeTab) activeTab.classList.add('active');
            
            if (tab === 'estudos') desenharTabela();
            if (tab === 'metas') atualizarMetas();
            if (tab === 'revisoes') {
                const stats = calcularEstatisticas();
                desenharTimelineRevisoes(stats);
            }
        };

        function desenharTimelineRevisoes(stats) {
            const timeline = document.getElementById('timelineRevisoes');
            if (!timeline) return;
            
            const hoje = new Date();
            let html = '';
            
            for (let dias = 0; dias < 30; dias++) {
                const data = new Date();
                data.setDate(hoje.getDate() + dias);
                const dataStr = data.toLocaleDateString('pt-BR');
                
                let revisoesDia = 0;
                let tipos = [];
                
                appData.forEach(d => {
                    d.topicos.forEach(t => {
                        if (t.data) {
                            const dataBase = new Date(t.data);
                            dataBase.setHours(0,0,0,0);
                            
                            REVISOES.forEach((diasRev, idx) => {
                                const dataRev = new Date(dataBase);
                                dataRev.setDate(dataRev.getDate() + diasRev);
                                
                                if (dataRev.toDateString() === data.toDateString() && !t.revisoes[idx]) {
                                    revisoesDia++;
                                    tipos.push(NOMES_REV[idx]);
                                }
                            });
                        }
                    });
                });
                
                if (revisoesDia > 0) {
                    const tiposUnicos = [...new Set(tipos)].join(', ');
                    html += `
                        <div class="flex items-center gap-4 p-2 bg-gray-800 rounded">
                            <div class="w-16 text-sm">+${dias}d</div>
                            <div class="flex-1">
                                <div class="font-medium">${dataStr}</div>
                                <div class="text-xs text-gray-500">${revisoesDia} revis√µes (${tiposUnicos})</div>
                            </div>
                        </div>
                    `;
                }
            }
            
            if (!html) html = '<p class="text-gray-500">Nenhuma revis√£o programada para os pr√≥ximos 30 dias</p>';
            timeline.innerHTML = html;
        }

        function abrirModal(titulo, conteudo) {
            document.getElementById('modalTitulo').textContent = titulo;
            document.getElementById('modalContent').innerHTML = conteudo;
            document.getElementById('modalLoading').style.display = 'none';
            document.getElementById('modal').style.display = 'flex';
        }

        window.fecharModal = function() {
            document.getElementById('modal').style.display = 'none';
        };

        function salvarDados() {
            localStorage.setItem('neuroai_dados_tecconcursos', JSON.stringify(appData));
            salvarDadosNuvem();
        }

        function atualizarTudo() {
            atualizarDashboard();
            desenharTabela();
            atualizarMetas();
        }

        // ========== INICIALIZA√á√ÉO ==========
        carregarDados();

        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                fecharModal();
            }
        };
    </script>
</body>
</html>